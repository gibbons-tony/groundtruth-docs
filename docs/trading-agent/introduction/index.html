<!doctype html>
<html lang="en" dir="ltr" class="docs-wrapper plugin-docs plugin-id-default docs-version-current docs-doc-page docs-doc-id-trading-agent/introduction" data-has-hydrated="false">
<head>
<meta charset="UTF-8">
<meta name="generator" content="Docusaurus v3.9.2">
<title data-rh="true">Trading Agent | Ground Truth</title><meta data-rh="true" name="viewport" content="width=device-width,initial-scale=1"><meta data-rh="true" name="twitter:card" content="summary_large_image"><meta data-rh="true" property="og:image" content="https://gibbons-tony.github.io/groundtruth-docs/img/caramanta-social-card.jpg"><meta data-rh="true" name="twitter:image" content="https://gibbons-tony.github.io/groundtruth-docs/img/caramanta-social-card.jpg"><meta data-rh="true" property="og:url" content="https://gibbons-tony.github.io/groundtruth-docs/docs/trading-agent/introduction"><meta data-rh="true" property="og:locale" content="en"><meta data-rh="true" name="docusaurus_locale" content="en"><meta data-rh="true" name="docsearch:language" content="en"><meta data-rh="true" name="docusaurus_version" content="current"><meta data-rh="true" name="docusaurus_tag" content="docs-default-current"><meta data-rh="true" name="docsearch:version" content="current"><meta data-rh="true" name="docsearch:docusaurus_tag" content="docs-default-current"><meta data-rh="true" property="og:title" content="Trading Agent | Ground Truth"><meta data-rh="true" name="description" content="Commodity trading strategy backtesting and optimization framework."><meta data-rh="true" property="og:description" content="Commodity trading strategy backtesting and optimization framework."><link data-rh="true" rel="icon" href="/groundtruth-docs/img/favicon.ico"><link data-rh="true" rel="canonical" href="https://gibbons-tony.github.io/groundtruth-docs/docs/trading-agent/introduction"><link data-rh="true" rel="alternate" href="https://gibbons-tony.github.io/groundtruth-docs/docs/trading-agent/introduction" hreflang="en"><link data-rh="true" rel="alternate" href="https://gibbons-tony.github.io/groundtruth-docs/docs/trading-agent/introduction" hreflang="x-default"><script data-rh="true" type="application/ld+json">{"@context":"https://schema.org","@type":"BreadcrumbList","itemListElement":[{"@type":"ListItem","position":1,"name":"Trading Agent","item":"https://gibbons-tony.github.io/groundtruth-docs/docs/trading-agent/introduction"}]}</script><link rel="stylesheet" href="/groundtruth-docs/assets/css/styles.a3858ef3.css">
<script src="/groundtruth-docs/assets/js/runtime~main.34d90d79.js" defer="defer"></script>
<script src="/groundtruth-docs/assets/js/main.27d4d2a1.js" defer="defer"></script>
</head>
<body class="navigation-with-keyboard">
<svg style="display: none;"><defs>
<symbol id="theme-svg-external-link" viewBox="0 0 24 24"><path fill="currentColor" d="M21 13v10h-21v-19h12v2h-10v15h17v-8h2zm3-12h-10.988l4.035 4-6.977 7.07 2.828 2.828 6.977-7.07 4.125 4.172v-11z"/></symbol>
</defs></svg>
<script>!function(){var t=function(){try{return new URLSearchParams(window.location.search).get("docusaurus-theme")}catch(t){}}()||function(){try{return window.localStorage.getItem("theme")}catch(t){}}();document.documentElement.setAttribute("data-theme",t||(window.matchMedia("(prefers-color-scheme: dark)").matches?"dark":"light")),document.documentElement.setAttribute("data-theme-choice",t||"system")}(),function(){try{const c=new URLSearchParams(window.location.search).entries();for(var[t,e]of c)if(t.startsWith("docusaurus-data-")){var a=t.replace("docusaurus-data-","data-");document.documentElement.setAttribute(a,e)}}catch(t){}}()</script><div id="__docusaurus"><link rel="preload" as="image" href="/groundtruth-docs/img/logo.svg"><div role="region" aria-label="Skip to main content"><a class="skipToContent_fXgn" href="#__docusaurus_skipToContent_fallback">Skip to main content</a></div><nav aria-label="Main" class="theme-layout-navbar navbar navbar--fixed-top"><div class="navbar__inner"><div class="theme-layout-navbar-left navbar__items"><button aria-label="Toggle navigation bar" aria-expanded="false" class="navbar__toggle clean-btn" type="button"><svg width="30" height="30" viewBox="0 0 30 30" aria-hidden="true"><path stroke="currentColor" stroke-linecap="round" stroke-miterlimit="10" stroke-width="2" d="M4 7h22M4 15h22M4 23h22"></path></svg></button><a class="navbar__brand" href="/groundtruth-docs/"><div class="navbar__logo"><img src="/groundtruth-docs/img/logo.svg" alt="Caramanta Logo" class="themedComponent_mlkZ themedComponent--light_NVdE"><img src="/groundtruth-docs/img/logo.svg" alt="Caramanta Logo" class="themedComponent_mlkZ themedComponent--dark_xIcU"></div><b class="navbar__title text--truncate">Ground Truth</b></a><a class="navbar__item navbar__link" href="/groundtruth-docs/docs/overview">Overview</a><a class="navbar__item navbar__link" href="/groundtruth-docs/docs/research-agent/introduction">Research Agent</a><a class="navbar__item navbar__link" href="/groundtruth-docs/docs/forecast-agent/introduction">Forecast Agent</a><a aria-current="page" class="navbar__item navbar__link navbar__link--active" href="/groundtruth-docs/docs/trading-agent/introduction">Trading Agent</a></div><div class="theme-layout-navbar-right navbar__items navbar__items--right"><a href="https://studiomios.wixstudio.com/caramanta" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">Live System<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><a href="https://github.com/gibbonstony/ucberkeley-capstone" target="_blank" rel="noopener noreferrer" class="navbar__item navbar__link">GitHub<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a><div class="toggle_vylO colorModeToggle_DEke"><button class="clean-btn toggleButton_gllP toggleButtonDisabled_aARS" type="button" disabled="" title="system mode" aria-label="Switch between dark and light mode (currently system mode)"><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP lightToggleIcon_pyhR"><path fill="currentColor" d="M12,9c1.65,0,3,1.35,3,3s-1.35,3-3,3s-3-1.35-3-3S10.35,9,12,9 M12,7c-2.76,0-5,2.24-5,5s2.24,5,5,5s5-2.24,5-5 S14.76,7,12,7L12,7z M2,13l2,0c0.55,0,1-0.45,1-1s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S1.45,13,2,13z M20,13l2,0c0.55,0,1-0.45,1-1 s-0.45-1-1-1l-2,0c-0.55,0-1,0.45-1,1S19.45,13,20,13z M11,2v2c0,0.55,0.45,1,1,1s1-0.45,1-1V2c0-0.55-0.45-1-1-1S11,1.45,11,2z M11,20v2c0,0.55,0.45,1,1,1s1-0.45,1-1v-2c0-0.55-0.45-1-1-1C11.45,19,11,19.45,11,20z M5.99,4.58c-0.39-0.39-1.03-0.39-1.41,0 c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0s0.39-1.03,0-1.41L5.99,4.58z M18.36,16.95 c-0.39-0.39-1.03-0.39-1.41,0c-0.39,0.39-0.39,1.03,0,1.41l1.06,1.06c0.39,0.39,1.03,0.39,1.41,0c0.39-0.39,0.39-1.03,0-1.41 L18.36,16.95z M19.42,5.99c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06c-0.39,0.39-0.39,1.03,0,1.41 s1.03,0.39,1.41,0L19.42,5.99z M7.05,18.36c0.39-0.39,0.39-1.03,0-1.41c-0.39-0.39-1.03-0.39-1.41,0l-1.06,1.06 c-0.39,0.39-0.39,1.03,0,1.41s1.03,0.39,1.41,0L7.05,18.36z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP darkToggleIcon_wfgR"><path fill="currentColor" d="M9.37,5.51C9.19,6.15,9.1,6.82,9.1,7.5c0,4.08,3.32,7.4,7.4,7.4c0.68,0,1.35-0.09,1.99-0.27C17.45,17.19,14.93,19,12,19 c-3.86,0-7-3.14-7-7C5,9.07,6.81,6.55,9.37,5.51z M12,3c-4.97,0-9,4.03-9,9s4.03,9,9,9s9-4.03,9-9c0-0.46-0.04-0.92-0.1-1.36 c-0.98,1.37-2.58,2.26-4.4,2.26c-2.98,0-5.4-2.42-5.4-5.4c0-1.81,0.89-3.42,2.26-4.4C12.92,3.04,12.46,3,12,3L12,3z"></path></svg><svg viewBox="0 0 24 24" width="24" height="24" aria-hidden="true" class="toggleIcon_g3eP systemToggleIcon_QzmC"><path fill="currentColor" d="m12 21c4.971 0 9-4.029 9-9s-4.029-9-9-9-9 4.029-9 9 4.029 9 9 9zm4.95-13.95c1.313 1.313 2.05 3.093 2.05 4.95s-0.738 3.637-2.05 4.95c-1.313 1.313-3.093 2.05-4.95 2.05v-14c1.857 0 3.637 0.737 4.95 2.05z"></path></svg></button></div><div class="navbarSearchContainer_Bca1"></div></div></div><div role="presentation" class="navbar-sidebar__backdrop"></div></nav><div id="__docusaurus_skipToContent_fallback" class="theme-layout-main main-wrapper mainWrapper_z2l0"><div class="docsWrapper_hBAB"><button aria-label="Scroll back to top" class="clean-btn theme-back-to-top-button backToTopButton_sjWU" type="button"></button><div class="docRoot_UBD9"><aside class="theme-doc-sidebar-container docSidebarContainer_YfHR"><div class="sidebarViewport_aRkj"><div class="sidebar_njMd"><nav aria-label="Docs sidebar" class="menu thin-scrollbar menu_SIkG"><ul class="theme-doc-sidebar-menu menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-1 menu__list-item"><a class="menu__link" href="/groundtruth-docs/docs/overview"><span title="Overview" class="linkLabel_WmDU">Overview</span></a></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/groundtruth-docs/docs/forecast-agent/introduction"><span title="forecast-agent" class="categoryLinkLabel_W154">forecast-agent</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item menu__list-item--collapsed"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret" role="button" aria-expanded="false" href="/groundtruth-docs/docs/research-agent/introduction"><span title="research-agent" class="categoryLinkLabel_W154">research-agent</span></a></div></li><li class="theme-doc-sidebar-item-category theme-doc-sidebar-item-category-level-1 menu__list-item"><div class="menu__list-item-collapsible"><a class="categoryLink_byQd menu__link menu__link--sublist menu__link--sublist-caret menu__link--active" role="button" aria-expanded="true" href="/groundtruth-docs/docs/trading-agent/introduction"><span title="trading-agent" class="categoryLinkLabel_W154">trading-agent</span></a></div><ul class="menu__list"><li class="theme-doc-sidebar-item-link theme-doc-sidebar-item-link-level-2 menu__list-item"><a class="menu__link menu__link--active" aria-current="page" tabindex="0" href="/groundtruth-docs/docs/trading-agent/introduction"><span title="Trading Agent" class="linkLabel_WmDU">Trading Agent</span></a></li></ul></li></ul></nav></div></div></aside><main class="docMainContainer_TBSr"><div class="container padding-top--md padding-bottom--lg"><div class="row"><div class="col docItemCol_VOVn"><div class="docItemContainer_Djhp"><article><nav class="theme-doc-breadcrumbs breadcrumbsContainer_Z_bl" aria-label="Breadcrumbs"><ul class="breadcrumbs"><li class="breadcrumbs__item"><a aria-label="Home page" class="breadcrumbs__link" href="/groundtruth-docs/"><svg viewBox="0 0 24 24" class="breadcrumbHomeIcon_YNFT"><path d="M10 19v-5h4v5c0 .55.45 1 1 1h3c.55 0 1-.45 1-1v-7h1.7c.46 0 .68-.57.33-.87L12.67 3.6c-.38-.34-.96-.34-1.34 0l-8.36 7.53c-.34.3-.13.87.33.87H5v7c0 .55.45 1 1 1h3c.55 0 1-.45 1-1z" fill="currentColor"></path></svg></a></li><li class="breadcrumbs__item"><span class="breadcrumbs__link">trading-agent</span></li><li class="breadcrumbs__item breadcrumbs__item--active"><span class="breadcrumbs__link">Trading Agent</span></li></ul></nav><div class="tocCollapsible_ETCw theme-doc-toc-mobile tocMobile_ITEo"><button type="button" class="clean-btn tocCollapsibleButton_TO0P">On this page</button></div><div class="theme-doc-markdown markdown"><header><h1>Trading Agent</h1></header>
<p>Commodity trading strategy backtesting and optimization framework.</p>
<p><strong>Source Code</strong>: <code>trading_agent/production/</code> (9,105 lines across 3 subsystems)</p>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="system-architecture">System Architecture<a href="#system-architecture" class="hash-link" aria-label="Direct link to System Architecture" title="Direct link to System Architecture" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="three-tier-design">Three-Tier Design<a href="#three-tier-design" class="hash-link" aria-label="Direct link to Three-Tier Design" title="Direct link to Three-Tier Design" translate="no">​</a></h3>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">┌─────────────────────────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ 1. BACKTESTING ENGINE (Core Logic)                          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    - BacktestEngine: 400 lines                              │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    - Harvest cycle management                               │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    - Cost modeling (storage + transaction)                  │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    - Force liquidation logic                                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└────────────────────┬────────────────────────────────────────┘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">┌────────────────────▼────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ 2. STRATEGY IMPLEMENTATIONS (Trading Logic)                 │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    - 10 strategies: 2,916 lines total                       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    - Base class: Strategy (ABC)                             │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    - 4 baseline strategies: 340 lines                       │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    - 5 prediction-based: 1,190 lines                        │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    - 1 MPC optimization: 290 lines                          │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└────────────────────┬────────────────────────────────────────┘</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">                     │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">┌────────────────────▼────────────────────────────────────────┐</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│ 3. EXECUTION FRAMEWORK (Orchestration)                      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    - Runners: 2,172 lines                                   │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    - Data loading, strategy execution, results storage      │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    - Multi-commodity support                                │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│    - Visualization (220+ charts)                            │</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└─────────────────────────────────────────────────────────────┘</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="code-structure">Code Structure<a href="#code-structure" class="hash-link" aria-label="Direct link to Code Structure" title="Direct link to Code Structure" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="production-system-9105-lines">Production System (9,105 lines)<a href="#production-system-9105-lines" class="hash-link" aria-label="Direct link to Production System (9,105 lines)" title="Direct link to Production System (9,105 lines)" translate="no">​</a></h3>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">production/</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── core/                         400 lines</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   └── backtest_engine.py        Harvest-aware backtesting</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── strategies/                 2,916 lines</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── base.py                    76 lines - Abstract base class</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── baseline.py               340 lines - 4 baseline strategies</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── prediction.py           1,190 lines - 5 prediction strategies</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── rolling_horizon_mpc.py    290 lines - MPC optimization</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── indicators.py             174 lines - Technical indicators</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── lp_optimizer.py           213 lines - Linear programming</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   └── theoretical_max.py        269 lines - Perfect foresight benchmark</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── runners/                    2,172 lines</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── data_loader.py            353 lines - Load prices + forecasts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── strategy_runner.py        391 lines - Execute single strategy</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── multi_commodity_runner.py 526 lines - Orchestrate all combinations</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── result_saver.py           346 lines - Save to Delta Lake</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   └── visualization.py          510 lines - Generate 220+ charts</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── analysis/                   4,017 lines</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── statistical_tests.py    1,292 lines - Paired t-tests, bootstrap CI</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   ├── strategy_analysis.py      379 lines - Efficiency ratios</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│   └── trade_level_stats.py      408 lines - Per-trade analysis</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">│</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── config.py                     277 lines - Central configuration</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">├── parameter_manager.py          700 lines - Parameter optimization</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">└── run_backtest_workflow.py      800 lines - Orchestration</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="configuration-system">Configuration System<a href="#configuration-system" class="hash-link" aria-label="Direct link to Configuration System" title="Direct link to Configuration System" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="centralized-parameters-configpy">Centralized Parameters (<code>config.py</code>)<a href="#centralized-parameters-configpy" class="hash-link" aria-label="Direct link to centralized-parameters-configpy" title="Direct link to centralized-parameters-configpy" translate="no">​</a></h3>
<p><strong>Commodity Configuration</strong>:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">COMMODITY_CONFIGS </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&#x27;coffee&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&#x27;harvest_volume&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">50</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># tons/year</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&#x27;harvest_windows&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">5</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">9</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># May-September</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&#x27;storage_cost_pct_per_day&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.005</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 0.5% per day</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&#x27;transaction_cost_pct&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.01</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">       </span><span class="token comment" style="color:#999988;font-style:italic"># 1% per transaction</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&#x27;max_holding_days&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">365</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&#x27;sugar&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&#x27;harvest_volume&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">50</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&#x27;harvest_windows&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">10</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">12</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Oct-Dec</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&#x27;storage_cost_pct_per_day&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.005</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&#x27;transaction_cost_pct&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.01</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&#x27;max_holding_days&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">365</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p><strong>Why These Parameters?</strong></p>
<ul>
<li class=""><strong>0.5% storage/day</strong>: Based on diagnostic research (<code>CHANGELOG.md:2025-12-04</code>)</li>
<li class=""><strong>1% transaction</strong>: Industry standard for commodity futures</li>
<li class=""><strong>365-day max</strong>: Quality degradation after 1 year</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="strategy-parameters">Strategy Parameters<a href="#strategy-parameters" class="hash-link" aria-label="Direct link to Strategy Parameters" title="Direct link to Strategy Parameters" translate="no">​</a></h3>
<p><strong>Baseline Strategies</strong> (no predictions):</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">BASELINE_PARAMS </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&#x27;immediate_sale&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Sell immediately, no params</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&#x27;equal_batch&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&#x27;batch_size&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.25</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># 25% per batch</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&#x27;frequency_days&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">30</span><span class="token plain">      </span><span class="token comment" style="color:#999988;font-style:italic"># Monthly sales</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&#x27;price_threshold&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&#x27;threshold_pct&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.05</span><span class="token plain">     </span><span class="token comment" style="color:#999988;font-style:italic"># Sell when price above MA + 5%</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&#x27;moving_average&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&#x27;ma_period&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">30</span><span class="token plain">          </span><span class="token comment" style="color:#999988;font-style:italic"># 30-day moving average</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<p><strong>Prediction-Based Strategies</strong> (use forecasts):</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">PREDICTION_PARAMS </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&#x27;consensus&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&#x27;consensus_threshold&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.70</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 70% paths bullish to hold</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&#x27;evaluation_day&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">14</span><span class="token plain">          </span><span class="token comment" style="color:#999988;font-style:italic"># Check 14-day forecast</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&#x27;expected_value&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&#x27;min_net_benefit_pct&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.5</span><span class="token plain">   </span><span class="token comment" style="color:#999988;font-style:italic"># 0.5% minimum gain to wait</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token string" style="color:#e3116c">&#x27;risk_adjusted&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&#x27;min_return&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.03</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">              </span><span class="token comment" style="color:#999988;font-style:italic"># 3% minimum return</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&#x27;max_uncertainty_low&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.05</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">     </span><span class="token comment" style="color:#999988;font-style:italic"># CV below 5% = low risk</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&#x27;max_uncertainty_medium&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.10</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># CV below 10% = med risk</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token string" style="color:#e3116c">&#x27;max_uncertainty_high&#x27;</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.20</span><span class="token plain">     </span><span class="token comment" style="color:#999988;font-style:italic"># CV below 20% = high risk</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token punctuation" style="color:#393A34">}</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="parameter-management-system">Parameter Management System<a href="#parameter-management-system" class="hash-link" aria-label="Direct link to Parameter Management System" title="Direct link to Parameter Management System" translate="no">​</a></h3>
<p><strong>Automatic Optimization Integration</strong> (<code>parameter_manager.py</code>):</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">ParameterManager</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    Intelligent parameter management with automatic optimization fallback.</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    Design:</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">        1. Try loading optimized parameters (from Optuna)</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">        2. Fall back to defaults if not found</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">        3. Log parameter source for transparency</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    &quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">get_params</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> source</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;auto&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># source=&#x27;optimized&#x27; → Use Optuna results only</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># source=&#x27;default&#x27;   → Use hardcoded defaults</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token comment" style="color:#999988;font-style:italic"># source=&#x27;auto&#x27;      → Try optimized, fall back to default</span><br></span></code></pre></div></div>
<p><strong>Optimization Storage</strong>:</p>
<ul>
<li class="">Path: <code>/dbfs/production/files/optimized_params_{commodity}_{model}_v{version}.json</code></li>
<li class="">Format: JSON with all strategy parameters</li>
<li class="">Versioning: Multiple optimization runs tracked</li>
</ul>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="backtesting-engine">Backtesting Engine<a href="#backtesting-engine" class="hash-link" aria-label="Direct link to Backtesting Engine" title="Direct link to Backtesting Engine" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="core-design-backtest_enginepy">Core Design (<code>backtest_engine.py</code>)<a href="#core-design-backtest_enginepy" class="hash-link" aria-label="Direct link to core-design-backtest_enginepy" title="Direct link to core-design-backtest_enginepy" translate="no">​</a></h3>
<p><strong>Harvest-Based Inventory</strong> (lines 12-116):</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">BacktestEngine</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    Key Innovation: Inventory starts at ZERO and accumulates during harvest.</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    Traditional approach: Start with full inventory</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    Our approach: Model realistic harvest accumulation</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    &quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">_create_harvest_schedule</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">        Calculate daily inventory increments during harvest windows.</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">        Example (Coffee):</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">            - Harvest: May-September (153 days)</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">            - Volume: 50 tons/year</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">            - Daily increment: 50 / 153 = 0.327 tons/day</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">        &quot;&quot;&quot;</span><br></span></code></pre></div></div>
<p><strong>Price Conversion</strong> (line 18):</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># CRITICAL: Futures prices in cents/lb, need $/ton</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">price_per_ton </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> price </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">20</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># 1 ton = 2000 lbs, cents→dollars</span><br></span></code></pre></div></div>
<p><strong>Cost Modeling</strong> (lines 200-230):</p>
<p><strong>Storage Costs</strong>:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Percentage-based (scales with commodity value)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">daily_storage_cost </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> inventory </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> price_per_ton </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> storage_cost_pct_per_day</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">total_storage </span><span class="token operator" style="color:#393A34">+=</span><span class="token plain"> daily_storage_cost</span><br></span></code></pre></div></div>
<p><strong>Transaction Costs</strong>:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Applied when selling</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">transaction_cost </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> sale_value </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> transaction_cost_pct</span><br></span></code></pre></div></div>
<p><strong>Force Liquidation</strong> (lines 56-76):</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">_force_liquidation_check</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> day</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> inventory</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    Two-tier liquidation to prevent quality loss:</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    1. Days 345-364: Gradual sell (5%/day)</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    2. Day 365: Force sell ALL remaining</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">    &quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    days_since_harvest </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> day </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> harvest_start</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> days_since_harvest </span><span class="token operator" style="color:#393A34">&gt;=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">365</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> SELL_ALL  </span><span class="token comment" style="color:#999988;font-style:italic"># Hard deadline</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">elif</span><span class="token plain"> days_since_harvest </span><span class="token operator" style="color:#393A34">&gt;=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">345</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> SELL</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">inventory </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.05</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Gradual liquidation</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="trading-strategies">Trading Strategies<a href="#trading-strategies" class="hash-link" aria-label="Direct link to Trading Strategies" title="Direct link to Trading Strategies" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="design-pattern">Design Pattern<a href="#design-pattern" class="hash-link" aria-label="Direct link to Design Pattern" title="Direct link to Design Pattern" translate="no">​</a></h3>
<p>All strategies inherit from <code>Strategy</code> base class:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">Strategy</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">ABC</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token decorator annotation punctuation" style="color:#393A34">@abstractmethod</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">decide</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">self</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> day</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> inventory</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> current_price</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> price_history</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> predictions</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">        Args:</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">            day: Current day index</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">            inventory: Current inventory (tons)</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">            current_price: Price (cents/lb)</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">            price_history: DataFrame with date + price</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">            predictions: numpy array (n_paths, 14_days) for forecast strategies</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">        Returns:</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">            dict: {&#x27;action&#x27;: &#x27;SELL&#x27;|&#x27;HOLD&#x27;, &#x27;amount&#x27;: float, &#x27;reason&#x27;: str}</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">        &quot;&quot;&quot;</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="baseline-strategies-4">Baseline Strategies (4)<a href="#baseline-strategies-4" class="hash-link" aria-label="Direct link to Baseline Strategies (4)" title="Direct link to Baseline Strategies (4)" translate="no">​</a></h3>
<p><strong>1. ImmediateSaleStrategy</strong> (<code>baseline.py:29-70</code>)</p>
<p>Sell all inventory immediately at regular intervals.</p>
<p><strong>Parameters</strong>:</p>
<ul>
<li class=""><code>min_batch_size</code>: 5.0 tons</li>
<li class=""><code>sale_frequency_days</code>: 7 days</li>
</ul>
<p><strong>Logic</strong>:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> days_since_last_sale </span><span class="token operator" style="color:#393A34">&gt;=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">7</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">and</span><span class="token plain"> inventory </span><span class="token operator" style="color:#393A34">&gt;=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">5.0</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> SELL</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">inventory</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Liquidate everything</span><br></span></code></pre></div></div>
<p><strong>2. EqualBatchStrategy</strong> (<code>baseline.py:73-107</code>)</p>
<p>Divide harvest into equal batches, sell on fixed schedule.</p>
<p><strong>Parameters</strong>:</p>
<ul>
<li class=""><code>batch_size</code>: 0.25 (25%)</li>
<li class=""><code>frequency_days</code>: 30</li>
</ul>
<p><strong>Logic</strong>:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> days_since_sale </span><span class="token operator" style="color:#393A34">&gt;=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">30</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> SELL</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">inventory </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.25</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Sell quarter each month</span><br></span></code></pre></div></div>
<p><strong>3. PriceThresholdStrategy</strong> (<code>baseline.py:110-218</code>)</p>
<p>Sell when price exceeds 30-day moving average by threshold %.</p>
<p><strong>Parameters</strong>:</p>
<ul>
<li class=""><code>threshold_pct</code>: 0.05 (5%)</li>
<li class="">Batch sizes modulated by RSI + ADX</li>
</ul>
<p><strong>Technical Indicators</strong> (<code>indicators.py</code>):</p>
<ul>
<li class=""><strong>RSI</strong> (Relative Strength Index): Momentum oscillator</li>
<li class=""><strong>ADX</strong> (Average Directional Index): Trend strength</li>
</ul>
<p><strong>Logic</strong>:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ma_30 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> price_history</span><span class="token punctuation" style="color:#393A34">[</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">30</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">mean</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">threshold </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ma_30 </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.05</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> current_price </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> threshold</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Modulate batch size by indicators</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> rsi </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">70</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">and</span><span class="token plain"> adx </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">25</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> SELL</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">inventory </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.35</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Overbought + strong trend</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">elif</span><span class="token plain"> rsi </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">70</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> SELL</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">inventory </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.30</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Overbought</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">else</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> SELL</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">inventory </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.25</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Baseline</span><br></span></code></pre></div></div>
<p><strong>4. MovingAverageStrategy</strong> (<code>baseline.py:220-340</code>)</p>
<p>Sell on moving average crossover signals.</p>
<p><strong>Parameters</strong>:</p>
<ul>
<li class=""><code>ma_period</code>: 30 days</li>
</ul>
<p><strong>Logic</strong>:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ma_current </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> price_history</span><span class="token punctuation" style="color:#393A34">[</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">30</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">mean</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ma_previous </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> price_history</span><span class="token punctuation" style="color:#393A34">[</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">31</span><span class="token punctuation" style="color:#393A34">:</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">mean</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Upward crossover</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> prev_price </span><span class="token operator" style="color:#393A34">&lt;=</span><span class="token plain"> ma_previous </span><span class="token keyword" style="color:#00009f">and</span><span class="token plain"> current_price </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> ma_current</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> rsi </span><span class="token operator" style="color:#393A34">&gt;=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">40</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">and</span><span class="token plain"> rsi </span><span class="token operator" style="color:#393A34">&lt;=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">70</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">and</span><span class="token plain"> adx </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">25</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> SELL</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">inventory </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.30</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Strong signal</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="prediction-based-strategies-5">Prediction-Based Strategies (5)<a href="#prediction-based-strategies-5" class="hash-link" aria-label="Direct link to Prediction-Based Strategies (5)" title="Direct link to Prediction-Based Strategies (5)" translate="no">​</a></h3>
<p>All prediction strategies use <strong>2,000 Monte Carlo forecast paths × 14 days</strong> from <code>commodity.forecast.distributions</code>.</p>
<p><strong>5. PriceThresholdPredictive</strong> (<code>prediction.py:46-380</code>)</p>
<p>Baseline PriceThreshold + forecast overlay with 3-tier confidence system.</p>
<p><strong>Three-Tier Prediction Integration</strong>:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">cv </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> coefficient_of_variation</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">predictions</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Forecast uncertainty</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> cv </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.05</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># HIGH confidence (CV below 5%): OVERRIDE baseline</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> strong_upward_signal</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> HOLD  </span><span class="token comment" style="color:#999988;font-style:italic"># Wait for better price</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">elif</span><span class="token plain"> strong_downward</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> SELL</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">inventory </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.40</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Aggressive sell</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">elif</span><span class="token plain"> cv </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.15</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># MEDIUM confidence (CV below 15%): BLEND with baseline</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    baseline_decision </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> run_baseline_logic</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> upward_prediction</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        reduce_sell_amount</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">baseline_decision </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.6</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">else</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> baseline_decision</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">else</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># LOW confidence (CV above 15%): FOLLOW baseline exactly</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> run_price_threshold_baseline</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p><strong>6. MovingAveragePredictive</strong> (<code>prediction.py:387-732</code>)</p>
<p>Baseline MovingAverage + forecast direction confirmation.</p>
<p><strong>Logic</strong>:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">ma_signal </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> check_ma_crossover</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">forecast_direction </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> analyze_14day_trend</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">predictions</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> ma_signal </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> BUY </span><span class="token keyword" style="color:#00009f">and</span><span class="token plain"> forecast_direction </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> UPWARD</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> HOLD  </span><span class="token comment" style="color:#999988;font-style:italic"># Both agree, wait</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">elif</span><span class="token plain"> ma_signal </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> SELL </span><span class="token keyword" style="color:#00009f">and</span><span class="token plain"> forecast_direction </span><span class="token operator" style="color:#393A34">==</span><span class="token plain"> DOWNWARD</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> SELL</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">inventory </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> batch_size</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Both agree, sell</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">else</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> HOLD  </span><span class="token comment" style="color:#999988;font-style:italic"># Conflicting signals, wait</span><br></span></code></pre></div></div>
<p><strong>7. ExpectedValueStrategy</strong> (<code>prediction.py:736-868</code>)</p>
<p>Maximize expected return using forecast distribution.</p>
<p><strong>Expected Value Calculation</strong>:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># For each of 14 forecast days</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">expected_values </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> day </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">15</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Median of 2,000 paths</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    median_price </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> np</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">median</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">predictions</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> day</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Subtract costs</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    storage_cost </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">day </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> storage_cost_pct_per_day </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> median_price</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    transaction_cost </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> transaction_cost_pct </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> median_price</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    net_value </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> median_price </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> storage_cost </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> transaction_cost</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    expected_values</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">append</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">net_value</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">optimal_day </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> argmax</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">expected_values</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">best_ev </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">max</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">expected_values</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">sell_today_ev </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> current_price </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> transaction_cost</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> best_ev </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> sell_today_ev </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> min_net_benefit_pct</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> HOLD  </span><span class="token comment" style="color:#999988;font-style:italic"># Waiting has positive expected value</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">else</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> SELL</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">inventory </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> batch_size</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p><strong>8. ConsensusStrategy</strong> (<code>prediction.py:873-1029</code>)</p>
<p>Democratic vote across 2,000 forecast paths.</p>
<p><strong>Consensus Voting</strong>:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># At 14-day horizon</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">final_prices </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> predictions</span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">:</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">13</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># All paths at day 14</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">current_price </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> price_history</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">iloc</span><span class="token punctuation" style="color:#393A34">[</span><span class="token operator" style="color:#393A34">-</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Count bullish paths (above 3% return)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bullish_paths </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">final_prices </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> current_price </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1.03</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">.</span><span class="token builtin">sum</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bullish_pct </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> bullish_paths </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2000</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> bullish_pct </span><span class="token operator" style="color:#393A34">&gt;=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.85</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Very strong consensus (85%+ bullish)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> HOLD</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">elif</span><span class="token plain"> bullish_pct </span><span class="token operator" style="color:#393A34">&gt;=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.70</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Strong consensus (70%+ bullish)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> cv </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.05</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> HOLD  </span><span class="token comment" style="color:#999988;font-style:italic"># High confidence, hold</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">else</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> SELL</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">inventory </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.15</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Gradual sell</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">elif</span><span class="token plain"> bullish_pct </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.30</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Bearish consensus (below 30% bullish)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> SELL</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">inventory </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.35</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Aggressive sell</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">else</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Weak consensus (30-60%)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> SELL</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">inventory </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.25</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Default sell</span><br></span></code></pre></div></div>
<p><strong>9. RiskAdjustedStrategy</strong> (<code>prediction.py:1035-1190</code>)</p>
<p>Balance expected return vs forecast uncertainty (Sharpe ratio approach).</p>
<p><strong>Risk-Adjusted Decision</strong>:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">expected_return </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> calculate_expected_value</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">predictions</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">uncertainty </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> std_dev</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">predictions</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> mean</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">predictions</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Coefficient of variation</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Sharpe-like ratio</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">risk_adjusted_return </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> expected_return </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">1</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> uncertainty</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">if</span><span class="token plain"> uncertainty </span><span class="token operator" style="color:#393A34">&lt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.05</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">and</span><span class="token plain"> expected_return </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.03</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># Low risk, decent return</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> HOLD</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">elif</span><span class="token plain"> uncertainty </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.20</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token comment" style="color:#999988;font-style:italic"># High uncertainty, sell to reduce risk</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> SELL</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">inventory </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> batch_size</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="model-predictive-control-1">Model Predictive Control (1)<a href="#model-predictive-control-1" class="hash-link" aria-label="Direct link to Model Predictive Control (1)" title="Direct link to Model Predictive Control (1)" translate="no">​</a></h3>
<p><strong>10. RollingHorizonMPC</strong> (<code>rolling_horizon_mpc.py:39-290</code>)</p>
<p>Rolling horizon optimization using linear programming.</p>
<p><strong>Linear Programming Formulation</strong>:</p>
<p><strong>Decision Variables</strong>:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">x </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">x_1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> x_2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> x_14</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Amount to sell each day</span><br></span></code></pre></div></div>
<p><strong>Objective Function</strong>:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">maximize</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"> Σ</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">price_t </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> x_t </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> storage_cost_t </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> transaction_cost_t</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">          </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> t </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1.</span><span class="token number" style="color:#36acaa">.14</span><br></span></code></pre></div></div>
<p><strong>Constraints</strong>:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 1. Non-negativity</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">x_t </span><span class="token operator" style="color:#393A34">&gt;=</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0</span><span class="token plain">  </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> </span><span class="token builtin">all</span><span class="token plain"> t</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 2. Inventory conservation</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Σ</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">x_t</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">&lt;=</span><span class="token plain"> current_inventory</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># 3. Daily bounds</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">x_t </span><span class="token operator" style="color:#393A34">&lt;=</span><span class="token plain"> inventory </span><span class="token operator" style="color:#393A34">*</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">0.40</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Max 40% per day</span><br></span></code></pre></div></div>
<p><strong>Implementation</strong> (using scipy.optimize.linprog):</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">from</span><span class="token plain"> scipy</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">optimize </span><span class="token keyword" style="color:#00009f">import</span><span class="token plain"> linprog</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Coefficients (negative for minimization)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">c </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">price_1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">price_2</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain">price_14</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> storage_costs </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> transaction_costs</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Inequality constraints (A_ub @ x &lt;= b_ub)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">A_ub </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">1</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain">  </span><span class="token comment" style="color:#999988;font-style:italic"># Sum constraint</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">b_ub </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">inventory</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Bounds</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bounds </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> inventory</span><span class="token operator" style="color:#393A34">*</span><span class="token number" style="color:#36acaa">0.40</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> _ </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">14</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">result </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> linprog</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">c</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> A_ub</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">A_ub</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> b_ub</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">b_ub</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> bounds</span><span class="token operator" style="color:#393A34">=</span><span class="token plain">bounds</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> method</span><span class="token operator" style="color:#393A34">=</span><span class="token string" style="color:#e3116c">&#x27;highs&#x27;</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Execute first day&#x27;s decision</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">return</span><span class="token plain"> SELL</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">result</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">x</span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">0</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="execution-framework">Execution Framework<a href="#execution-framework" class="hash-link" aria-label="Direct link to Execution Framework" title="Direct link to Execution Framework" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="runners-system-runners">Runners System (<code>runners/</code>)<a href="#runners-system-runners" class="hash-link" aria-label="Direct link to runners-system-runners" title="Direct link to runners-system-runners" translate="no">​</a></h3>
<p><strong>Data Flow</strong>:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">data_loader.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ↓ (prices + forecasts)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">strategy_runner.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ↓ (backtest results)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">multi_commodity_runner.py</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ↓ (aggregate results)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">result_saver.py → Delta Lake</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    ↓</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">visualization.py → 220+ charts</span><br></span></code></pre></div></div>
<p><strong>1. DataLoader</strong> (<code>data_loader.py:353 lines</code>)</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">DataLoader</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">load_price_data</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">commodity</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> start_date</span><span class="token operator" style="color:#393A34">=</span><span class="token boolean" style="color:#36acaa">None</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">        Load from commodity.silver.unified_data</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">        Returns: DataFrame with date + price</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">        &quot;&quot;&quot;</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">load_forecast_distributions</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">commodity</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> model_version</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">        Load from commodity.forecast.distributions</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">        Returns: Dict mapping date → numpy array (2000 paths × 14 days)</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">        &quot;&quot;&quot;</span><br></span></code></pre></div></div>
<p><strong>2. StrategyRunner</strong> (<code>strategy_runner.py:391 lines</code>)</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token keyword" style="color:#00009f">class</span><span class="token plain"> </span><span class="token class-name">StrategyRunner</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token keyword" style="color:#00009f">def</span><span class="token plain"> </span><span class="token function" style="color:#d73a49">run_backtest</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">strategy</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> prices</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> predictions</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> config</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">        </span><span class="token triple-quoted-string string" style="color:#e3116c">&quot;&quot;&quot;</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">        Execute single strategy across all historical dates.</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="display:inline-block;color:#e3116c"></span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">        Returns:</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">            - Daily state DataFrame</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">            - Trade log</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">            - Performance metrics (earnings, Sharpe, trades)</span><br></span><span class="token-line" style="color:#393A34"><span class="token triple-quoted-string string" style="color:#e3116c">        &quot;&quot;&quot;</span><br></span></code></pre></div></div>
<p><strong>3. MultiCommodityRunner</strong> (<code>multi_commodity_runner.py:526 lines</code>)</p>
<p>Orchestrates all combinations:</p>
<ul>
<li class="">2 commodities (Coffee, Sugar)</li>
<li class="">10+ models per commodity</li>
<li class="">10 strategies</li>
<li class="">= 200+ backtest runs</li>
</ul>
<p><strong>4. ResultSaver</strong> (<code>result_saver.py:346 lines</code>)</p>
<p>Saves to Delta Lake:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Summary table</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">commodity</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">trading_agent</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">results_</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">commodity</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain">_</span><span class="token punctuation" style="color:#393A34">{</span><span class="token plain">model</span><span class="token punctuation" style="color:#393A34">}</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> strategy</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> net_earnings</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> sharpe_ratio</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> n_trades</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Detailed results (pickle files)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token operator" style="color:#393A34">/</span><span class="token plain">Volumes</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">commodity</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">trading_agent</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">files</span><span class="token operator" style="color:#393A34">/</span><span class="token plain">results_detailed_</span><span class="token operator" style="color:#393A34">*</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">pkl</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> Daily state</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> Trade</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">by</span><span class="token operator" style="color:#393A34">-</span><span class="token plain">trade log</span><br></span></code></pre></div></div>
<p><strong>5. Visualization</strong> (<code>visualization.py:510 lines</code>)</p>
<p>Generates 220+ charts:</p>
<ul>
<li class="">Cumulative earnings by strategy</li>
<li class="">Inventory timeline</li>
<li class="">Price vs sale timing</li>
<li class="">Strategy heatmaps</li>
<li class="">Performance comparisons</li>
</ul>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="statistical-analysis">Statistical Analysis<a href="#statistical-analysis" class="hash-link" aria-label="Direct link to Statistical Analysis" title="Direct link to Statistical Analysis" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="statistical-testing-framework-analysisstatistical_testspy1292-lines">Statistical Testing Framework (<code>analysis/statistical_tests.py:1,292 lines</code>)<a href="#statistical-testing-framework-analysisstatistical_testspy1292-lines" class="hash-link" aria-label="Direct link to statistical-testing-framework-analysisstatistical_testspy1292-lines" title="Direct link to statistical-testing-framework-analysisstatistical_testspy1292-lines" translate="no">​</a></h3>
<p><strong>Primary Comparison</strong>: Prediction strategies vs Immediate Sale baseline</p>
<p><strong>Tests Applied</strong>:</p>
<p><strong>1. Paired t-test</strong>:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># Compare SAME years for both strategies</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">years </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">2020</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2021</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2022</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2023</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2024</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">strategy_earnings </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">125k</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> 130k</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> 128k</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> 135k</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> 132k</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">baseline_earnings </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token plain">98k</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> 102k</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> 100k</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> 105k</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> 103k</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">t_stat</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> p_value </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> ttest_rel</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">strategy_earnings</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> baseline_earnings</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Significant if p &lt; 0.05</span><br></span></code></pre></div></div>
<p><strong>2. Effect Size (Cohen&#x27;s d)</strong>:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">mean_diff </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> mean</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">strategy</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">-</span><span class="token plain"> mean</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">baseline</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">pooled_std </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> sqrt</span><span class="token punctuation" style="color:#393A34">(</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">std</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">strategy</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">² </span><span class="token operator" style="color:#393A34">+</span><span class="token plain"> std</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">baseline</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain">²</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"> </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">2</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">cohens_d </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> mean_diff </span><span class="token operator" style="color:#393A34">/</span><span class="token plain"> pooled_std</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Interpretation:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Small: |d| = 0.2</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Medium: |d| = 0.5</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token comment" style="color:#999988;font-style:italic"># Large: |d| = 0.8+</span><br></span></code></pre></div></div>
<p><strong>3. Bootstrap Confidence Intervals</strong>:</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># 10,000 resamples</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">bootstrap_diffs </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token punctuation" style="color:#393A34">]</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain"></span><span class="token keyword" style="color:#00009f">for</span><span class="token plain"> _ </span><span class="token keyword" style="color:#00009f">in</span><span class="token plain"> </span><span class="token builtin">range</span><span class="token punctuation" style="color:#393A34">(</span><span class="token number" style="color:#36acaa">10000</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">:</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    sample </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> resample</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">year_differences</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">    bootstrap_diffs</span><span class="token punctuation" style="color:#393A34">.</span><span class="token plain">append</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">mean</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">sample</span><span class="token punctuation" style="color:#393A34">)</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">ci_95 </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> percentile</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">bootstrap_diffs</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token punctuation" style="color:#393A34">[</span><span class="token number" style="color:#36acaa">2.5</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> </span><span class="token number" style="color:#36acaa">97.5</span><span class="token punctuation" style="color:#393A34">]</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p><strong>4. Sign Test</strong> (non-parametric):</p>
<div class="language-python codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-python codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token comment" style="color:#999988;font-style:italic"># How many years did strategy beat baseline?</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">wins </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> </span><span class="token builtin">sum</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">strategy </span><span class="token operator" style="color:#393A34">&gt;</span><span class="token plain"> baseline</span><span class="token punctuation" style="color:#393A34">)</span><span class="token plain"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">p_value </span><span class="token operator" style="color:#393A34">=</span><span class="token plain"> binomial_test</span><span class="token punctuation" style="color:#393A34">(</span><span class="token plain">wins</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> n_years</span><span class="token punctuation" style="color:#393A34">,</span><span class="token plain"> p</span><span class="token operator" style="color:#393A34">=</span><span class="token number" style="color:#36acaa">0.5</span><span class="token punctuation" style="color:#393A34">)</span><br></span></code></pre></div></div>
<p><strong>Output Example</strong>:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">Rolling Horizon MPC vs Immediate Sale</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Sample Size: 5 years (2020-2024)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Paired t-test:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  t-statistic: 4.23</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  p-value: 0.014 ✓ SIGNIFICANT</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Effect Size:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Cohen&#x27;s d: 3.22 (Very large)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">95% CI: [$11,450, $42,990]</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  ✓ Does not include zero</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain" style="display:inline-block"></span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">Sign Test:</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  Years positive: 5/5</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">  p-value: 0.031 ✓ SIGNIFICANT</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="technology-stack">Technology Stack<a href="#technology-stack" class="hash-link" aria-label="Direct link to Technology Stack" title="Direct link to Technology Stack" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="core-technologies">Core Technologies<a href="#core-technologies" class="hash-link" aria-label="Direct link to Core Technologies" title="Direct link to Core Technologies" translate="no">​</a></h3>
<table><thead><tr><th>Component</th><th>Technology</th><th>Purpose</th></tr></thead><tbody><tr><td><strong>Compute</strong></td><td>Databricks (PySpark)</td><td>Distributed backtesting</td></tr><tr><td><strong>Storage</strong></td><td>Delta Lake</td><td>Results storage</td></tr><tr><td><strong>Catalog</strong></td><td>Unity Catalog</td><td>Data governance</td></tr><tr><td><strong>Optimization</strong></td><td>scipy.optimize</td><td>Linear programming (MPC)</td></tr><tr><td><strong>Statistics</strong></td><td>NumPy, Pandas, SciPy</td><td>Analysis, metrics</td></tr><tr><td><strong>Orchestration</strong></td><td>Python subprocess</td><td>Workflow management</td></tr></tbody></table>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="data-tables">Data Tables<a href="#data-tables" class="hash-link" aria-label="Direct link to Data Tables" title="Direct link to Data Tables" translate="no">​</a></h3>
<p><strong>Input Tables</strong>:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">commodity.silver.unified_data           # Historical prices</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">commodity.forecast.distributions        # Monte Carlo forecasts (2K paths)</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">commodity.bronze.fx_rates               # Exchange rates (15+ currencies)</span><br></span></code></pre></div></div>
<p><strong>Output Tables</strong>:</p>
<div class="language-text codeBlockContainer_Ckt0 theme-code-block" style="--prism-color:#393A34;--prism-background-color:#f6f8fa"><div class="codeBlockContent_QJqH"><pre tabindex="0" class="prism-code language-text codeBlock_bY9V thin-scrollbar" style="color:#393A34;background-color:#f6f8fa"><code class="codeBlockLines_e6Vv"><span class="token-line" style="color:#393A34"><span class="token plain">commodity.trading_agent.results_{commodity}_{model}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">commodity.trading_agent.results_{commodity}_by_year_{model}</span><br></span><span class="token-line" style="color:#393A34"><span class="token plain">commodity.trading_agent.statistical_tests_{commodity}_{model}</span><br></span></code></pre></div></div>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="workflows">Workflows<a href="#workflows" class="hash-link" aria-label="Direct link to Workflows" title="Direct link to Workflows" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="periodic-backtesting-monthly">Periodic Backtesting (Monthly)<a href="#periodic-backtesting-monthly" class="hash-link" aria-label="Direct link to Periodic Backtesting (Monthly)" title="Direct link to Periodic Backtesting (Monthly)" translate="no">​</a></h3>
<p><strong>Purpose</strong>: Evaluate strategy performance, identify best approaches</p>
<p><strong>Orchestrator</strong>: <code>run_backtest_workflow.py</code></p>
<p><strong>Steps</strong>:</p>
<ol>
<li class="">Load latest forecasts from <code>commodity.forecast.distributions</code></li>
<li class="">Run backtests: 10 strategies × 10+ models × 2 commodities</li>
<li class="">Calculate metrics (earnings, Sharpe, trades)</li>
<li class="">Run statistical tests</li>
<li class="">Identify best strategy per commodity-model</li>
<li class="">Save results to Delta Lake</li>
<li class="">Generate 220+ visualization charts</li>
</ol>
<p><strong>Duration</strong>: 30-45 minutes for all commodities</p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="daily-operations">Daily Operations<a href="#daily-operations" class="hash-link" aria-label="Direct link to Daily Operations" title="Direct link to Daily Operations" translate="no">​</a></h3>
<p><strong>Purpose</strong>: Generate trading recommendations</p>
<p><strong>Script</strong>: <code>operations/daily_recommendations.py</code></p>
<p><strong>Steps</strong>:</p>
<ol>
<li class="">Load today&#x27;s forecast for specified model</li>
<li class="">Load current state (inventory, price history)</li>
<li class="">Apply active strategy</li>
<li class="">Generate SELL/HOLD recommendation</li>
<li class="">Output JSON for WhatsApp integration</li>
</ol>
<p><strong>Duration</strong>: Less than 1 minute</p>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="design-decisions">Design Decisions<a href="#design-decisions" class="hash-link" aria-label="Direct link to Design Decisions" title="Direct link to Design Decisions" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="why-harvest-based-inventory">Why Harvest-Based Inventory?<a href="#why-harvest-based-inventory" class="hash-link" aria-label="Direct link to Why Harvest-Based Inventory?" title="Direct link to Why Harvest-Based Inventory?" translate="no">​</a></h3>
<p><strong>Traditional</strong>: Start with full inventory at year start
<strong>Our approach</strong>: Inventory accumulates during harvest windows</p>
<p><strong>Rationale</strong>:</p>
<ul>
<li class="">More realistic for agricultural producers</li>
<li class="">Models actual harvest timing</li>
<li class="">Prevents unrealistic pre-harvest sales</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="why-70-accuracy-threshold">Why 70% Accuracy Threshold?<a href="#why-70-accuracy-threshold" class="hash-link" aria-label="Direct link to Why 70% Accuracy Threshold?" title="Direct link to Why 70% Accuracy Threshold?" translate="no">​</a></h3>
<p><strong>Research</strong>: Synthetic model testing at 60%, 70%, 80%, 90%, 100% accuracy</p>
<p><strong>Finding</strong>: Below 70% directional accuracy, prediction-based strategies DO NOT beat baselines</p>
<p><strong>Source</strong>: <code>archive/notebooks/diagnostics/SYNTHETIC_PREDICTION_TEST_PLAN.md</code></p>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="why-05-storage-cost-per-day">Why 0.5% Storage Cost Per Day?<a href="#why-05-storage-cost-per-day" class="hash-link" aria-label="Direct link to Why 0.5% Storage Cost Per Day?" title="Direct link to Why 0.5% Storage Cost Per Day?" translate="no">​</a></h3>
<p><strong>Research</strong>: Diagnostic parameter sensitivity analysis</p>
<p><strong>Source</strong>: <code>CHANGELOG.md:2025-12-04</code> - &quot;Critical parameter alignment fixes applied&quot;</p>
<p><strong>Calculation</strong>:</p>
<ul>
<li class="">0.5% per day × 365 days = 182.5% annual storage cost</li>
<li class="">Reflects warehouse fees, insurance, quality degradation</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="why-2000-monte-carlo-paths">Why 2,000 Monte Carlo Paths?<a href="#why-2000-monte-carlo-paths" class="hash-link" aria-label="Direct link to Why 2,000 Monte Carlo Paths?" title="Direct link to Why 2,000 Monte Carlo Paths?" translate="no">​</a></h3>
<p><strong>Tradeoff</strong>: Accuracy vs compute cost</p>
<ul>
<li class="">100 paths: Too noisy</li>
<li class="">1,000 paths: Good but still variance</li>
<li class="">2,000 paths: Stable percentile estimates</li>
<li class="">10,000 paths: Diminishing returns</li>
</ul>
<p><strong>Source</strong>: <code>forecast_agent/docs/DESIGN_DECISIONS.md</code></p>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="performance-metrics">Performance Metrics<a href="#performance-metrics" class="hash-link" aria-label="Direct link to Performance Metrics" title="Direct link to Performance Metrics" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="line-counts-verified">Line Counts (Verified)<a href="#line-counts-verified" class="hash-link" aria-label="Direct link to Line Counts (Verified)" title="Direct link to Line Counts (Verified)" translate="no">​</a></h3>
<p><strong>Production System</strong>: 9,105 lines</p>
<ul>
<li class="">Core: 400 lines</li>
<li class="">Strategies: 2,916 lines</li>
<li class="">Runners: 2,172 lines</li>
<li class="">Analysis: 4,017 lines</li>
<li class="">Config: 277 lines</li>
<li class="">Orchestration: 800 lines</li>
</ul>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="execution-performance">Execution Performance<a href="#execution-performance" class="hash-link" aria-label="Direct link to Execution Performance" title="Direct link to Execution Performance" translate="no">​</a></h3>
<p><strong>Backtest Speed</strong>: 30-45 minutes for full analysis</p>
<ul>
<li class="">2 commodities</li>
<li class="">10+ models each</li>
<li class="">10 strategies</li>
<li class="">200+ total combinations</li>
</ul>
<p><strong>Statistical Tests</strong>: 5-10 minutes</p>
<ul>
<li class="">Paired t-tests</li>
<li class="">Bootstrap CI (10,000 iterations)</li>
<li class="">Effect sizes</li>
<li class="">Sign tests</li>
</ul>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="future-enhancements">Future Enhancements<a href="#future-enhancements" class="hash-link" aria-label="Direct link to Future Enhancements" title="Direct link to Future Enhancements" translate="no">​</a></h2>
<h3 class="anchor anchorTargetStickyNavbar_Vzrq" id="planned-features">Planned Features<a href="#planned-features" class="hash-link" aria-label="Direct link to Planned Features" title="Direct link to Planned Features" translate="no">​</a></h3>
<p><strong>1. Strategy Selection Automation</strong></p>
<ul>
<li class="">Store best strategy per commodity-model in config table</li>
<li class="">Daily operations auto-select active strategy</li>
</ul>
<p><strong>2. Performance Tracking</strong></p>
<ul>
<li class="">Log recommendations vs actual outcomes</li>
<li class="">Calculate recommendation accuracy over time</li>
</ul>
<p><strong>3. Multi-Objective Optimization</strong></p>
<ul>
<li class="">Optimize for earnings AND Sharpe ratio</li>
<li class="">Pareto frontier analysis</li>
</ul>
<p><strong>4. Real-Time Monitoring</strong></p>
<ul>
<li class="">Dashboard for live strategy performance</li>
<li class="">Alert system for anomalies</li>
</ul>
<hr>
<h2 class="anchor anchorTargetStickyNavbar_Vzrq" id="related-documentation">Related Documentation<a href="#related-documentation" class="hash-link" aria-label="Direct link to Related Documentation" title="Direct link to Related Documentation" translate="no">​</a></h2>
<ul>
<li class=""><strong>System Overview</strong>: <code>MASTER_SYSTEM_PLAN.md</code></li>
<li class=""><strong>Statistical Testing</strong>: <code>STATISTICAL_TESTING_REVIEW.md</code></li>
<li class=""><strong>Configuration</strong>: <code>production/README.md</code></li>
<li class=""><strong>Changelog</strong>: <code>production/CHANGELOG.md</code></li>
</ul>
<hr>
<p><strong>Last Updated</strong>: 2025-12-10
<strong>Source Code</strong>: <a href="https://github.com/gibbonstony/ucberkeley-capstone/tree/main/trading_agent" target="_blank" rel="noopener noreferrer" class="">GitHub</a></p></div><footer class="theme-doc-footer docusaurus-mt-lg"><div class="row margin-top--sm theme-doc-footer-edit-meta-row"><div class="col noPrint_WFHX"><a href="https://github.com/gibbonstony/ucberkeley-capstone/tree/main/docs/trading-agent/introduction.md" target="_blank" rel="noopener noreferrer" class="theme-edit-this-page"><svg fill="currentColor" height="20" width="20" viewBox="0 0 40 40" class="iconEdit_Z9Sw" aria-hidden="true"><g><path d="m34.5 11.7l-3 3.1-6.3-6.3 3.1-3q0.5-0.5 1.2-0.5t1.1 0.5l3.9 3.9q0.5 0.4 0.5 1.1t-0.5 1.2z m-29.5 17.1l18.4-18.5 6.3 6.3-18.4 18.4h-6.3v-6.2z"></path></g></svg>Edit this page</a></div><div class="col lastUpdated_JAkA"></div></div></footer></article><nav class="docusaurus-mt-lg pagination-nav" aria-label="Docs pages"><a class="pagination-nav__link pagination-nav__link--prev" href="/groundtruth-docs/docs/research-agent/introduction"><div class="pagination-nav__sublabel">Previous</div><div class="pagination-nav__label">Research Agent</div></a></nav></div></div><div class="col col--3"><div class="tableOfContents_bqdL thin-scrollbar theme-doc-toc-desktop"><ul class="table-of-contents table-of-contents__left-border"><li><a href="#system-architecture" class="table-of-contents__link toc-highlight">System Architecture</a><ul><li><a href="#three-tier-design" class="table-of-contents__link toc-highlight">Three-Tier Design</a></li></ul></li><li><a href="#code-structure" class="table-of-contents__link toc-highlight">Code Structure</a><ul><li><a href="#production-system-9105-lines" class="table-of-contents__link toc-highlight">Production System (9,105 lines)</a></li></ul></li><li><a href="#configuration-system" class="table-of-contents__link toc-highlight">Configuration System</a><ul><li><a href="#centralized-parameters-configpy" class="table-of-contents__link toc-highlight">Centralized Parameters (<code>config.py</code>)</a></li><li><a href="#strategy-parameters" class="table-of-contents__link toc-highlight">Strategy Parameters</a></li><li><a href="#parameter-management-system" class="table-of-contents__link toc-highlight">Parameter Management System</a></li></ul></li><li><a href="#backtesting-engine" class="table-of-contents__link toc-highlight">Backtesting Engine</a><ul><li><a href="#core-design-backtest_enginepy" class="table-of-contents__link toc-highlight">Core Design (<code>backtest_engine.py</code>)</a></li></ul></li><li><a href="#trading-strategies" class="table-of-contents__link toc-highlight">Trading Strategies</a><ul><li><a href="#design-pattern" class="table-of-contents__link toc-highlight">Design Pattern</a></li><li><a href="#baseline-strategies-4" class="table-of-contents__link toc-highlight">Baseline Strategies (4)</a></li><li><a href="#prediction-based-strategies-5" class="table-of-contents__link toc-highlight">Prediction-Based Strategies (5)</a></li><li><a href="#model-predictive-control-1" class="table-of-contents__link toc-highlight">Model Predictive Control (1)</a></li></ul></li><li><a href="#execution-framework" class="table-of-contents__link toc-highlight">Execution Framework</a><ul><li><a href="#runners-system-runners" class="table-of-contents__link toc-highlight">Runners System (<code>runners/</code>)</a></li></ul></li><li><a href="#statistical-analysis" class="table-of-contents__link toc-highlight">Statistical Analysis</a><ul><li><a href="#statistical-testing-framework-analysisstatistical_testspy1292-lines" class="table-of-contents__link toc-highlight">Statistical Testing Framework (<code>analysis/statistical_tests.py:1,292 lines</code>)</a></li></ul></li><li><a href="#technology-stack" class="table-of-contents__link toc-highlight">Technology Stack</a><ul><li><a href="#core-technologies" class="table-of-contents__link toc-highlight">Core Technologies</a></li><li><a href="#data-tables" class="table-of-contents__link toc-highlight">Data Tables</a></li></ul></li><li><a href="#workflows" class="table-of-contents__link toc-highlight">Workflows</a><ul><li><a href="#periodic-backtesting-monthly" class="table-of-contents__link toc-highlight">Periodic Backtesting (Monthly)</a></li><li><a href="#daily-operations" class="table-of-contents__link toc-highlight">Daily Operations</a></li></ul></li><li><a href="#design-decisions" class="table-of-contents__link toc-highlight">Design Decisions</a><ul><li><a href="#why-harvest-based-inventory" class="table-of-contents__link toc-highlight">Why Harvest-Based Inventory?</a></li><li><a href="#why-70-accuracy-threshold" class="table-of-contents__link toc-highlight">Why 70% Accuracy Threshold?</a></li><li><a href="#why-05-storage-cost-per-day" class="table-of-contents__link toc-highlight">Why 0.5% Storage Cost Per Day?</a></li><li><a href="#why-2000-monte-carlo-paths" class="table-of-contents__link toc-highlight">Why 2,000 Monte Carlo Paths?</a></li></ul></li><li><a href="#performance-metrics" class="table-of-contents__link toc-highlight">Performance Metrics</a><ul><li><a href="#line-counts-verified" class="table-of-contents__link toc-highlight">Line Counts (Verified)</a></li><li><a href="#execution-performance" class="table-of-contents__link toc-highlight">Execution Performance</a></li></ul></li><li><a href="#future-enhancements" class="table-of-contents__link toc-highlight">Future Enhancements</a><ul><li><a href="#planned-features" class="table-of-contents__link toc-highlight">Planned Features</a></li></ul></li><li><a href="#related-documentation" class="table-of-contents__link toc-highlight">Related Documentation</a></li></ul></div></div></div></div></main></div></div></div><footer class="theme-layout-footer footer footer--dark"><div class="container container-fluid"><div class="row footer__links"><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Agents</div><ul class="footer__items clean-list"><li class="footer__item"><a class="footer__link-item" href="/groundtruth-docs/docs/research-agent/introduction">Research Agent</a></li><li class="footer__item"><a class="footer__link-item" href="/groundtruth-docs/docs/forecast-agent/introduction">Forecast Agent</a></li><li class="footer__item"><a class="footer__link-item" href="/groundtruth-docs/docs/trading-agent/introduction">Trading Agent</a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">Resources</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://github.com/gibbonstony/ucberkeley-capstone" target="_blank" rel="noopener noreferrer" class="footer__link-item">GitHub Repository<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://studiomios.wixstudio.com/caramanta" target="_blank" rel="noopener noreferrer" class="footer__link-item">Live System<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div><div class="theme-layout-footer-column col footer__col"><div class="footer__title">UC Berkeley MIDS</div><ul class="footer__items clean-list"><li class="footer__item"><a href="https://www.ischool.berkeley.edu/" target="_blank" rel="noopener noreferrer" class="footer__link-item">School of Information<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li><li class="footer__item"><a href="https://www.ischool.berkeley.edu/programs/mids" target="_blank" rel="noopener noreferrer" class="footer__link-item">MIDS Program<svg width="13.5" height="13.5" aria-label="(opens in new tab)" class="iconExternalLink_nPIU"><use href="#theme-svg-external-link"></use></svg></a></li></ul></div></div><div class="footer__bottom text--center"><div class="footer__copyright">UC Berkeley Master of Information and Data Science (MIDS) Capstone Project 2024<br>Built with Docusaurus</div></div></div></footer></div>
</body>
</html>